# Mend DevOps Infrastructure

This repository contains the infrastructure code for creating and managing Managed Kubernetes Clusters on both AWS (EKS) and Azure (AKS) platforms. The infrastructure is designed to support a multi-cloud environment with proper networking, DNS management, and security configurations.

## Project Structure

```
infra/
├── modules/           # Reusable Terraform modules
│   ├── aws/          # AWS-specific modules (EKS, Networking)
│   └── azure/        # Azure-specific modules (AKS, Networking)
└── live/             # Environment-specific configurations
    └── mend-devops/
        ├── aws/      # AWS infrastructure for dev environment
        └── azure/    # Azure infrastructure for dev environment
```

## Prerequisites

Before deploying the infrastructure, ensure you have the following CLI tools installed:

### Required CLI Tools

1. **Terraform** - Infrastructure as Code tool
   - Download from: https://www.terraform.io/downloads.html
   - Version: ~> 1.0

2. **AWS CLI V2** - Amazon Web Services command line interface
   - Download from: https://aws.amazon.com/cli/
   - Version: 2.x

3. **Azure CLI (az)** - Microsoft Azure command line interface
   - Download from: https://docs.microsoft.com/en-us/cli/azure/install-azure-cli
   - Version: Latest

4. **Kubelogin** - Azure Kubernetes Service authentication plugin
   - Download from: https://github.com/Azure/kubelogin
   - Required for AKS cluster authentication

5. **Python** - Programming language for remote state scripts
   - Download from: https://www.python.org/downloads/
   - Version: 3.8+

## Cloud Account Setup

### AWS Account Configuration

#### 1. AWS Profile "mend-devops" (Account: 739929374881)
This account contains all the infrastructure for the "dev" environment.

**Setup Instructions:**
1. Create IAM Access Key ID and Secret Access Key in the AWS Console
2. Configure AWS credentials:
   ```bash
   aws configure --profile mend-devops
   ```
3. Enter your Access Key ID and Secret Access Key when prompted
4. Set default region to `eu-north-1`
5. Verify configuration:
   ```bash
   aws sts get-caller-identity --profile mend-devops
   ```

#### 2. AWS Profile "stav-devops" (Account: 882709358319)
This account holds the root DNS Zone "stavco9.com" and is used for DNS zone delegation.

**Setup Instructions:**
1. Configure AWS SSO:
   ```bash
   aws configure sso --profile stav-devops
   ```
2. Enter the following details:
   - SSO start URL: `https://d-9067bcdfe7.awsapps.com/`
   - SSO region: `us-east-1`
   - Account ID: `882709358319`
   - Role name: `AdministratorAccess`
3. Login to SSO:
   ```bash
   aws sso login --profile stav-devops
   ```
4. Verify configuration:
   ```bash
   aws sts get-caller-identity --profile stav-devops
   ```

### Azure Account Configuration

#### Azure Subscription Setup
- **Subscription ID**: `2bcfe589-26cd-455a-bdd4-b8975088c52f`
- **Tenant ID**: `5f9ccf0b-2066-472e-993a-438adb2f77e0`

**Setup Instructions:**
1. Login to Azure CLI with device code:
   ```bash
   az login --tenant 5f9ccf0b-2066-472e-993a-438adb2f77e0 --use-device-code
   ```
2. Set the active subscription:
   ```bash
   az account set --subscription 2bcfe589-26cd-455a-bdd4-b8975088c52f
   ```
3. Verify configuration:
   ```bash
   az account show
   ```

## Environment-Specific Documentation

### AWS Infrastructure
- [AWS Dev Environment](./live/mend-devops/aws/dev/README.md) - Complete setup and deployment guide for AWS EKS infrastructure

### Azure Infrastructure  
- [Azure Dev Environment](./live/mend-devops/azure/dev/README.md) - Complete setup and deployment guide for Azure AKS infrastructure

## Terraform Modules

This repository includes reusable Terraform modules for:

### AWS Modules
- **EKS Module** - Amazon Elastic Kubernetes Service cluster with IRSA, load balancer controller, and external DNS
- **Networking Module** - VPC, subnets, NAT gateways, and security groups

### Azure Modules
- **AKS Module** - Azure Kubernetes Service cluster with Application Gateway, cert-manager, and workload identity
- **Networking Module** - Virtual Network, subnets, and network security groups

Each module includes comprehensive documentation generated by `terraform-docs`. Refer to individual module README files for detailed usage instructions.

## Security Considerations

- All infrastructure resources are tagged with project, environment, and owner information
- Remote state is stored in encrypted S3 buckets (AWS) and Azure Storage Accounts (Azure)
- State locking is enabled using DynamoDB (AWS) and Azure Blob Storage (Azure)
- Public access is blocked on all storage resources
- TLS 1.2+ is enforced for all communications

## Support

For questions or issues related to this infrastructure, please contact the DevOps team or create an issue in the repository.
